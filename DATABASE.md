# üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö PostgreSQL –¥–ª—è Beatstore Bot

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **PostgreSQL** –≤ **Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ** –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö.

---

## üìã –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

- [–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç](#-–±—ã—Å—Ç—Ä—ã–π-—Å—Ç–∞—Ä—Ç)
- [–ß—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ](#-—á—Ç–æ-—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ)
- [–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏](#-—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ-docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏)
- [–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ pgAdmin](#-–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ-–∫-pgadmin)
- [–ö–∞–∫ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö](#-–∫–∞–∫-—Ä–∞–±–æ—Ç–∞—Ç—å-—Å-–±–∞–∑–æ–π-–¥–∞–Ω–Ω—ã—Ö)
- [–î–µ–ø–ª–æ–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä](#-–¥–µ–ø–ª–æ–π-–Ω–∞-—Å–µ—Ä–≤–µ—Ä)
- [–†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º](#-—Ä–µ—à–µ–Ω–∏–µ-–ø—Ä–æ–±–ª–µ–º)

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã

```bash
docker compose up -d --build
```

–≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞:
- –°–∫–∞—á–∞–µ—Ç –æ–±—Ä–∞–∑—ã PostgreSQL, pgAdmin –∏ Node.js (–ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ)
- –°–æ–±–µ—Ä–µ—Ç Docker –æ–±—Ä–∞–∑ –≤–∞—à–µ–≥–æ Node.js —Å–µ—Ä–≤–µ—Ä–∞
- –°–æ–∑–¥–∞—Å—Ç –∏ –∑–∞–ø—É—Å—Ç–∏—Ç 3 –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞: `beatstore-postgres`, `beatstore-pgadmin`, `beatstore-server`
- –í—ã–ø–æ–ª–Ω–∏—Ç —Ñ–∞–π–ª `server/database/init.sql` –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ë–î
- –°–æ–∑–¥–∞—Å—Ç Docker volumes –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∑–∞–ø—É—â–µ–Ω—ã

```bash
docker ps
```

–í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å 3 –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:
- `beatstore-postgres` - –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö PostgreSQL
- `beatstore-pgadmin` - –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ë–î
- `beatstore-server` - Node.js —Å–µ—Ä–≤–µ—Ä (Telegram –±–æ—Ç + API)

### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

```bash
docker-compose logs postgres
docker-compose logs pgadmin
```

---

## üì¶ –ß—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ

### PostgreSQL
- **–í–µ—Ä—Å–∏—è**: 16-alpine (–ª–µ–≥–∫–∏–π –æ–±—Ä–∞–∑)
- **–ü–æ—Ä—Ç**: 5432 (localhost:5432)
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: `beatstore_db`
- **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å**: `beatstore_user`
- **–ü–∞—Ä–æ–ª—å**: `simple123`

### pgAdmin (–≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å)
- **–ü–æ—Ä—Ç**: 5050 (http://localhost:5050)
- **Email**: admin@beatstore.com
- **–ü–∞—Ä–æ–ª—å**: admin112444

### Node.js Server
- **–ü–æ—Ä—Ç**: 8080 (localhost:8080)
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è** –∫ PostgreSQL —á–µ—Ä–µ–∑ Docker —Å–µ—Ç—å

---

## üéÆ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏

### –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
```bash
docker-compose up -d
```
–§–ª–∞–≥ `-d` –∑–∞–ø—É—Å–∫–∞–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ (detached).

### –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
```bash
docker-compose down
```
‚ö†Ô∏è –î–∞–Ω–Ω—ã–µ **–ù–ï —É–¥–∞–ª—è—Ç—Å—è** - –æ–Ω–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ Docker volumes.

### –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏ —É–¥–∞–ª–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ
```bash
docker-compose down -v
```
‚ö†Ô∏è **–í–ù–ò–ú–ê–ù–ò–ï**: –§–ª–∞–≥ `-v` —É–¥–∞–ª–∏—Ç volumes —Å –¥–∞–Ω–Ω—ã–º–∏ –ë–î!

### –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
```bash
docker-compose restart
```

### –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
```bash
docker ps                    # –ó–∞–ø—É—â–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker ps -a                 # –í—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã (–≤–∫–ª—é—á–∞—è –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ)
```

### –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏
```bash
docker-compose logs -f postgres    # –ª–æ–≥–∏ PostgreSQL (—Å –ø–æ–¥–ø–∏—Å–∫–æ–π –Ω–∞ –Ω–æ–≤—ã–µ)
docker-compose logs -f pgadmin     # –ª–æ–≥–∏ pgAdmin
docker-compose logs -f             # –ª–æ–≥–∏ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
```

---

## üåê –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ pgAdmin

1. **–û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä**: http://localhost:5050

2. **–í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É**:
   - Email: `admin@beatstore.com`
   - –ü–∞—Ä–æ–ª—å: `admin123`

3. **–î–æ–±–∞–≤—å—Ç–µ —Å–µ—Ä–≤–µ—Ä PostgreSQL**:
   - –ü—Ä–∞–≤—ã–π –∫–ª–∏–∫ –Ω–∞ "Servers" ‚Üí "Register" ‚Üí "Server..."
   - –í–∫–ª–∞–¥–∫–∞ "General":
     - Name: `Beatstore Server` (–ª—é–±–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ)
   - –í–∫–ª–∞–¥–∫–∞ "Connection":
     - Host name/address: `beatstore-postgres` (–∏–º—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –≤ Docker Compose)
     - Port: `5432`
     - Maintenance database: `beatstore_db`
     - Username: `beatstore_user`
     - Password: `simple123`
     - ‚úÖ Save password
   - –ù–∞–∂–º–∏—Ç–µ "Save"

4. **–ì–æ—Ç–æ–≤–æ!** –¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã, –≤—ã–ø–æ–ª–Ω—è—Ç—å SQL –∑–∞–ø—Ä–æ—Å—ã –∏ —É–ø—Ä–∞–≤–ª—è—Ç—å –ë–î —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å.

---

## üíª –ö–∞–∫ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö

### –ò–∑ Node.js –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```typescript
import { testConnection, pool } from "./db.js";

// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
await testConnection();

// –í—ã–ø–æ–ª–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å
const result = await pool.query("SELECT * FROM test_connection");
console.log(result.rows);
```

### –ò–∑ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ (psql)

```bash
docker exec -it beatstore-postgres psql -U beatstore_user -d beatstore_db
```

–ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –≤ psql:
```sql
\dt              -- –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã
\d table_name    -- –û–ø–∏—Å–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã
\q               -- –í—ã—Ö–æ–¥
```

### –í—ã–ø–æ–ª–Ω–∏—Ç—å SQL —Ñ–∞–π–ª

```bash
docker exec -i beatstore-postgres psql -U beatstore_user -d beatstore_db < path/to/file.sql
```

---

## üö¢ –î–µ–ø–ª–æ–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä

### –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ —Å Docker

1. **–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞** –Ω–∞ —Å–µ—Ä–≤–µ—Ä

2. **–û–±–Ω–æ–≤–∏—Ç–µ –ø–∞—Ä–æ–ª–∏** –≤ `docker-compose.yml` (–¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∏–ª—å–Ω—ã–µ –ø–∞—Ä–æ–ª–∏!)

3. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã**:
   ```bash
   docker-compose up -d
   ```

4. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ .env** –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

5. **–ì–æ—Ç–æ–≤–æ!** –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ.

### –ë—ç–∫–∞–ø –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```bash
# –°–æ–∑–¥–∞—Ç—å –±—ç–∫–∞–ø
docker exec beatstore-postgres pg_dump -U beatstore_user beatstore_db > backup.sql

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ –±—ç–∫–∞–ø–∞
docker exec -i beatstore-postgres psql -U beatstore_user -d beatstore_db < backup.sql
```

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –±—ç–∫–∞–ø (cron –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ)

```bash
# –î–æ–±–∞–≤–∏—Ç—å –≤ crontab (crontab -e)
0 2 * * * docker exec beatstore-postgres pg_dump -U beatstore_user beatstore_db > /backups/beatstore_$(date +\%Y\%m\%d).sql
```

---

## üîß –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

```bash
# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏
docker-compose logs postgres

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –Ω–µ –∑–∞–Ω—è—Ç –ª–∏ –ø–æ—Ä—Ç 5432
# Windows
netstat -ano | findstr :5432

# Linux/Mac
lsof -i :5432
```

### –ù–µ –º–æ–≥—É –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∏–∑ Node.js

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∑–∞–ø—É—â–µ–Ω—ã: `docker ps`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ `server/.env`
3. **–í–∞–∂–Ω–æ**: –ò–∑ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `DB_HOST=beatstore-postgres`, –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã - `localhost`
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞: `docker logs beatstore-server`
5. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ: `docker exec beatstore-server npx tsx test-db.ts`

### –ó–∞–±—ã–ª –ø–∞—Ä–æ–ª—å –æ—Ç pgAdmin

–£–¥–∞–ª–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏ volume pgAdmin, –∑–∞—Ç–µ–º –ø–µ—Ä–µ—Å–æ–∑–¥–∞–π—Ç–µ:
```bash
docker-compose down
docker volume rm beatstore-bot_pgadmin_data
docker-compose up -d
```

### –ù—É–∂–Ω–æ –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö

```bash
# –í–ù–ò–ú–ê–ù–ò–ï: –£–¥–∞–ª–∏—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ!
docker-compose down -v
docker-compose up -d
```

### –ò–∑–º–µ–Ω–∏—Ç—å init.sql –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –∑–∞–ø—É—Å–∫–∞

–§–∞–π–ª `init.sql` –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è **—Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ**. –ß—Ç–æ–±—ã –ø—Ä–∏–º–µ–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è:

```bash
# –£–¥–∞–ª–∏—Ç—å volume —Å –¥–∞–Ω–Ω—ã–º–∏
docker-compose down -v

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –∑–∞–Ω–æ–≤–æ (init.sql –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è)
docker-compose up -d
```

---

## üìö –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [Docker Compose –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://docs.docker.com/compose/)
- [PostgreSQL –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://www.postgresql.org/docs/)
- [pgAdmin –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://www.pgadmin.org/docs/)
- [node-postgres (pg) –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://node-postgres.com/)

---

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ –ó–∞–ø—É—Å—Ç–∏—Ç—å Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã: `docker-compose up -d`
2. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ pgAdmin: http://localhost:5050
3. ‚úÖ –û–ø–∏—Å–∞—Ç—å —Ñ–∏–Ω–∞–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ë–î –≤ `server/database/init.sql`
4. üîÑ –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –∫ –ë–î –≤ `server/src/index.ts`
5. üöÄ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫—É –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ –±–∏—Ç–æ–≤ —á–µ—Ä–µ–∑ API

---

**–£–¥–∞—á–∏ —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö! üöÄ**
